local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local plr = Players.LocalPlayer
local playerGui = plr:WaitForChild("PlayerGui")

-- العناصر المطلوب حذفها
local namesToDelete = {
    "CommandMenucommandLogs",
    "CommandMenuchatLogs",
    "Notices",
    "HDAdminNightVision",
    "CustomTopBar",
    "CmdBar"
}

-- واجهة التحكم
local gui = Instance.new("ScreenGui")
gui.Name = "DeleteControl"
gui.ResetOnSpawn = false
gui.Parent = playerGui

-- الإطار الرئيسي
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 150)
frame.Position = UDim2.new(0, 10, 0, 10)  -- في أعلى اليسار
frame.BackgroundColor3 = Color3.fromRGB(10, 20, 10)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = false
frame.Parent = gui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = frame

local stroke = Instance.new("UIStroke")
stroke.Color = Color3.fromRGB(50, 180, 50)
stroke.Thickness = 2
stroke.Parent = frame

-- العنوان
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 25)
title.Position = UDim2.new(0, 0, 0, 5)
title.BackgroundTransparency = 1
title.Text = "ANTI SPAM CMD"
title.Font = Enum.Font.GothamBlack
title.TextSize = 16
title.TextColor3 = Color3.fromRGB(50, 255, 50)
title.Parent = frame

-- زر Start/Stop داخل الإطار
local button = Instance.new("TextButton")
button.Size = UDim2.new(1, -20, 0, 40)
button.Position = UDim2.new(0, 10, 0, 35)
button.BackgroundColor3 = Color3.fromRGB(20, 100, 20)
button.Text = "START"
button.Font = Enum.Font.GothamBlack
button.TextSize = 14
button.TextColor3 = Color3.fromRGB(220, 255, 220)
button.AutoButtonColor = false
button.Parent = frame

local buttonCorner = Instance.new("UICorner")
buttonCorner.CornerRadius = UDim.new(0, 8)
buttonCorner.Parent = button

local buttonStroke = Instance.new("UIStroke")
buttonStroke.Color = Color3.fromRGB(30, 150, 30)
buttonStroke.Thickness = 1.5
buttonStroke.Parent = button

-- زر Del CmdBar داخل الإطار
local delCmdBarButton = Instance.new("TextButton")
delCmdBarButton.Size = UDim2.new(1, -20, 0, 40)
delCmdBarButton.Position = UDim2.new(0, 10, 0, 85)
delCmdBarButton.BackgroundColor3 = Color3.fromRGB(20, 80, 120)
delCmdBarButton.Text = "DEL CMD BAR"
delCmdBarButton.Font = Enum.Font.GothamBlack
delCmdBarButton.TextSize = 12
delCmdBarButton.TextColor3 = Color3.fromRGB(220, 240, 255)
delCmdBarButton.AutoButtonColor = false
delCmdBarButton.Parent = frame

local delCmdBarCorner = Instance.new("UICorner")
delCmdBarCorner.CornerRadius = UDim.new(0, 8)
delCmdBarCorner.Parent = delCmdBarButton

local delCmdBarStroke = Instance.new("UIStroke")
delCmdBarStroke.Color = Color3.fromRGB(30, 100, 150)
delCmdBarStroke.Thickness = 1.5
delCmdBarStroke.Parent = delCmdBarButton

-- التحكم في التشغيل
local deleting = false
local hdRemovalConnection = nil

-- دالة لمسح كل الأشياء اللي اسمها HDAdminNightVision
local function removeHD()
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj.Name == "HDAdminNightVision" then
            obj:Destroy()
        end
    end
end

-- دالة لتغيير اسم Template5
local function modifyTemplateName(removeNumber)
    local hd = playerGui:FindFirstChild("HDAdminInterface")
    if hd then
        local templates = hd:FindFirstChild("MenuTemplates")
        if templates then
            local template5 = templates:FindFirstChild("Template5")
            if template5 then
                if removeNumber then
                    -- نحذف الرقم 5 من الاسم (يتحول من Template5 إلى Template)
                    local originalName = template5.Name
                    local newName = originalName:gsub("5", "")
                    template5.Name = newName
                    template5:SetAttribute("OriginalName", originalName)
                    print("تم تغيير الاسم إلى:", newName)
                else
                    -- نرجع الاسم الأصلي (يتحول من Template إلى Template5)
                    local originalName = template5:GetAttribute("OriginalName")
                    if originalName then
                        template5.Name = originalName
                        print("تم إرجاع الاسم إلى:", originalName)
                    end
                end
            else
                -- إذا ما لقينا Template5، نجرب نبحث عن Template (اللي بدون رقم 5)
                local template = templates:FindFirstChild("Template")
                if template and removeNumber == false then
                    local originalName = template:GetAttribute("OriginalName")
                    if originalName then
                        template.Name = originalName
                        print("تم إرجاع الاسم إلى:", originalName)
                    end
                end
            end
        end
    end
end

-- دالة لبدء إزالة HDAdminNightVision
local function startHDRemoval()
    if hdRemovalConnection then
        hdRemovalConnection:Disconnect()
    end
    
    hdRemovalConnection = RunService.Heartbeat:Connect(function()
        removeHD()
        wait(0.5)  -- تأخير 0.5 ثانية بين كل عملية فحص
    end)
end

-- دالة لإيقاف إزالة HDAdminNightVision
local function stopHDRemoval()
    if hdRemovalConnection then
        hdRemovalConnection:Disconnect()
        hdRemovalConnection = nil
    end
end

-- عملية الحذف الأساسية
RunService.Heartbeat:Connect(function()
    if not deleting then return end

    for _, name in ipairs(namesToDelete) do
        local target = playerGui:FindFirstChild(name, true)
        if target then target:Destroy() end
    end

    for _, p in pairs(Players:GetPlayers()) do
        if p.Character then
            local nv = p.Character:FindFirstChild("HDAdminNightVision", true)
            if nv then nv:Destroy() end
        end
    end
end)

-- وظيفة حذف CmdBar و CustomTopBar من PlayerGui فقط
local function deleteCmdBars()
    for _, name in ipairs({"CustomTopBar", "CmdBar"}) do
        local target = playerGui:FindFirstChild(name, true)
        if target then 
            target:Destroy()
        end
    end
end

-- نظام السحب من الإطار كامل
local dragging
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = frame.Position
        
        -- تأثير بسيط عند السحب
        frame.BackgroundTransparency = 0.1
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
                frame.BackgroundTransparency = 0
            end
        end)
    end
end)

frame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- عند الضغط على الزر الأول → Start/Stop
button.MouseButton1Click:Connect(function()
    deleting = not deleting
    if deleting then
        button.Text = "STOP"
        button.BackgroundColor3 = Color3.fromRGB(180, 20, 20)
        buttonStroke.Color = Color3.fromRGB(220, 50, 50)
        -- تغيير اسم Template5 عند START (يحذف الرقم 5)
        modifyTemplateName(true)
        -- بدء إزالة HDAdminNightVision
        startHDRemoval()
    else
        button.Text = "START"
        button.BackgroundColor3 = Color3.fromRGB(20, 100, 20)
        buttonStroke.Color = Color3.fromRGB(30, 150, 30)
        -- إرجاع الاسم الأصلي عند STOP (يرجع الرقم 5)
        modifyTemplateName(false)
        -- إيقاف إزالة HDAdminNightVision
        stopHDRemoval()
    end
end)

-- عند الضغط على زر Del CmdBar
delCmdBarButton.MouseButton1Click:Connect(function()
    deleteCmdBars()
    delCmdBarButton.Text = "DELETED!"
    delCmdBarButton.BackgroundColor3 = Color3.fromRGB(20, 150, 20)
    delCmdBarStroke.Color = Color3.fromRGB(30, 200, 30)
    
    -- العودة إلى النص الأصلي بعد ثانيتين
    wait(2)
    delCmdBarButton.Text = "DEL CMD BAR"
    delCmdBarButton.BackgroundColor3 = Color3.fromRGB(20, 80, 120)
    delCmdBarStroke.Color = Color3.fromRGB(30, 100, 150)
end)
