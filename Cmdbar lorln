-- LOR - FLY Steal a brainrot
-- واجهة مستخدم مع تصميم محسن وأنيميشن

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")

-- اللاعب المحلي
local LocalPlayer = Players.LocalPlayer

-- إنشاء واجهة المستخدم في CoreGui
local CoreGui = game:GetService("CoreGui")
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "LORFlyUI"
ScreenGui.Parent = CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false

-- قائمة صور عشوائية للزر الدائري
local randomImages = {
    "rbxassetid://1278123456",
    "rbxassetid://1278234567", 
    "rbxassetid://1278345678",
    "rbxassetid://1278456789",
    "rbxassetid://1278567890",
    "rbxassetid://1278678901",
    "rbxassetid://1278789012",
    "rbxassetid://1278890123"
}

-- زر دائري للفتح (على اليمين)
local CircleOpenButton = Instance.new("ImageButton")
CircleOpenButton.Name = "CircleOpenButton"
CircleOpenButton.Size = UDim2.new(0, 50, 0, 50)
CircleOpenButton.Position = UDim2.new(1, -70, 0.5, -25)
CircleOpenButton.AnchorPoint = Vector2.new(1, 0.5)
CircleOpenButton.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
CircleOpenButton.BorderSizePixel = 0
CircleOpenButton.Image = randomImages[math.random(1, #randomImages)]
CircleOpenButton.Visible = true
CircleOpenButton.Parent = ScreenGui

local CircleCorner = Instance.new("UICorner")
CircleCorner.CornerRadius = UDim.new(1, 0)
CircleCorner.Parent = CircleOpenButton

local CircleStroke = Instance.new("UIStroke")
CircleStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
CircleStroke.Color = Color3.fromRGB(100, 100, 200)
CircleStroke.Thickness = 2
CircleStroke.Parent = CircleOpenButton

-- الإطار الرئيسي (مخفي في البداية)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 320, 0, 250)
MainFrame.Position = UDim2.new(0.5, -160, 0.5, -125)
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true
MainFrame.Visible = false
MainFrame.Parent = ScreenGui

-- أنيميشن الظهور
local function showMainFrame()
    MainFrame.Visible = true
    MainFrame.Size = UDim2.new(0, 0, 0, 0)
    MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    
    local sizeTween = TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 320, 0, 250),
        Position = UDim2.new(0.5, -160, 0.5, -125)
    })
    
    sizeTween:Play()
end

-- أنيميشن الإخفاء
local function hideMainFrame()
    local sizeTween = TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
        Size = UDim2.new(0, 0, 0, 0),
        Position = UDim2.new(0.5, 0, 0.5, 0)
    })
    
    sizeTween:Play()
    sizeTween.Completed:Connect(function()
        MainFrame.Visible = false
        CircleOpenButton.Visible = true
        CircleOpenButton.Image = randomImages[math.random(1, #randomImages)]
    end)
end

-- الزوايا المستديرة
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = MainFrame

-- إطار الظل
local ShadowFrame = Instance.new("Frame")
ShadowFrame.Size = UDim2.new(1, 10, 1, 10)
ShadowFrame.Position = UDim2.new(0, -5, 0, -5)
ShadowFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
ShadowFrame.BackgroundTransparency = 0.8
ShadowFrame.BorderSizePixel = 0
ShadowFrame.ZIndex = -1
ShadowFrame.Parent = MainFrame

local ShadowCorner = Instance.new("UICorner")
ShadowCorner.CornerRadius = UDim.new(0, 16)
ShadowCorner.Parent = ShadowFrame

-- العنوان
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
Title.BorderSizePixel = 0
Title.Font = Enum.Font.GothamBold
Title.Text = "LOR - FLY Steal a brainrot"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 16
Title.Parent = MainFrame

-- زوايا مستديرة للعنوان
local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 12)
TitleCorner.Parent = Title

-- زر السحب
local DragHandle = Instance.new("TextButton")
DragHandle.Name = "DragHandle"
DragHandle.Size = UDim2.new(1, 0, 0, 40)
DragHandle.Position = UDim2.new(0, 0, 0, 0)
DragHandle.BackgroundTransparency = 1
DragHandle.Text = ""
DragHandle.ZIndex = 2
DragHandle.Parent = MainFrame

-- زر الإغلاق (X)
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 25, 0, 25)
CloseButton.Position = UDim2.new(1, -30, 0, 8)
CloseButton.BackgroundColor3 = Color3.fromRGB(220, 80, 80)
CloseButton.BorderSizePixel = 0
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 14
CloseButton.ZIndex = 3
CloseButton.Parent = MainFrame

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(1, 0)
CloseCorner.Parent = CloseButton

-- زر التصغير/التكبير
local ToggleSizeButton = Instance.new("TextButton")
ToggleSizeButton.Name = "ToggleSizeButton"
ToggleSizeButton.Size = UDim2.new(0, 25, 0, 25)
ToggleSizeButton.Position = UDim2.new(1, -60, 0, 8)
ToggleSizeButton.BackgroundColor3 = Color3.fromRGB(200, 160, 80)
ToggleSizeButton.BorderSizePixel = 0
ToggleSizeButton.Font = Enum.Font.GothamBold
ToggleSizeButton.Text = "-"
ToggleSizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleSizeButton.TextSize = 16
ToggleSizeButton.ZIndex = 3
ToggleSizeButton.Parent = MainFrame

local ToggleSizeCorner = Instance.new("UICorner")
ToggleSizeCorner.CornerRadius = UDim.new(1, 0)
ToggleSizeCorner.Parent = ToggleSizeButton

-- زر التشغيل/الإيقاف
local ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ToggleButton"
ToggleButton.Size = UDim2.new(0, 100, 0, 40)
ToggleButton.Position = UDim2.new(0.5, -50, 0.3, -20)
ToggleButton.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
ToggleButton.BorderSizePixel = 0
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.Text = "OFF"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.TextSize = 16
ToggleButton.ZIndex = 2
ToggleButton.Parent = MainFrame

-- زوايا مستديرة للزر
local ButtonCorner = Instance.new("UICorner")
ButtonCorner.CornerRadius = UDim.new(0, 8)
ButtonCorner.Parent = ToggleButton

-- زر حفظ الموقع
local SaveSpawnButton = Instance.new("TextButton")
SaveSpawnButton.Name = "SaveSpawnButton"
SaveSpawnButton.Size = UDim2.new(0, 120, 0, 30)
SaveSpawnButton.Position = UDim2.new(0.5, -60, 0.6, -15)
SaveSpawnButton.BackgroundColor3 = Color3.fromRGB(80, 120, 200)
SaveSpawnButton.BorderSizePixel = 0
SaveSpawnButton.Font = Enum.Font.Gotham
SaveSpawnButton.Text = "حفظ الموقع"
SaveSpawnButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SaveSpawnButton.TextSize = 14
SaveSpawnButton.Parent = MainFrame

-- زر الانتقال إلى نقطة الريسباون
local TeleportSpawnButton = Instance.new("TextButton")
TeleportSpawnButton.Name = "TeleportSpawnButton"
TeleportSpawnButton.Size = UDim2.new(0, 120, 0, 30)
TeleportSpawnButton.Position = UDim2.new(0.5, -60, 0.8, -15)
TeleportSpawnButton.BackgroundColor3 = Color3.fromRGB(200, 120, 80)
TeleportSpawnButton.BorderSizePixel = 0
TeleportSpawnButton.Font = Enum.Font.Gotham
TeleportSpawnButton.Text = "تشغيل الجري"
TeleportSpawnButton.TextColor3 = Color3.fromRGB(255, 255, 255)
TeleportSpawnButton.TextSize = 14
TeleportSpawnButton.Parent = MainFrame

-- زوايا مستديرة للأزرار
local SmallButtonCorner = Instance.new("UICorner")
SmallButtonCorner.CornerRadius = UDim.new(0, 6)
SmallButtonCorner.Parent = SaveSpawnButton
SmallButtonCorner:Clone().Parent = TeleportSpawnButton

-- متغيرات السحب
local Dragging = false
local DragInput, DragStart, StartPosition
local minimized = false
local originalSize = MainFrame.Size
local originalPosition = MainFrame.Position

-- وظائف السحب
local function Update(input)
    local Delta = input.Position - DragStart
    MainFrame.Position = UDim2.new(
        StartPosition.X.Scale, 
        StartPosition.X.Offset + Delta.X,
        StartPosition.Y.Scale, 
        StartPosition.Y.Offset + Delta.Y
    )
end

DragHandle.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        Dragging = true
        DragStart = input.Position
        StartPosition = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                Dragging = false
            end
        end)
    end
end)

DragHandle.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        DragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == DragInput and Dragging then
        Update(input)
    end
end)

-- تخزين الأرضية للاعب المحلي فقط
local playerFloor = nil
local enabled = false

-- تخزين موقع الريسباون
local customSpawnPoint = nil
local running = false

-- وظيفة إنشاء/تحديث الأرضية
local function updateFloorUnderPlayer()
    if not enabled then return end
    
    local character = LocalPlayer.Character
    if not character then return end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    if not playerFloor or not playerFloor.Parent then
        -- إنشاء الأرضية الجديدة إذا ما موجودة
        playerFloor = Instance.new("Part")
        playerFloor.Name = "PlayerFloor_" .. LocalPlayer.Name
        playerFloor.Size = Vector3.new(10, 1, 10)
        playerFloor.BrickColor = BrickColor.new("Bright blue")
        playerFloor.Material = Enum.Material.Neon
        playerFloor.Anchored = true
        playerFloor.CanCollide = true
        playerFloor.Transparency = 0.3
        playerFloor.Parent = workspace

        -- إضافة Decal على كل جانب
        local faces = {
            Enum.NormalId.Top,
            Enum.NormalId.Bottom,
            Enum.NormalId.Left,
            Enum.NormalId.Right,
            Enum.NormalId.Front,
            Enum.NormalId.Back
        }

        for _, face in ipairs(faces) do
            local decal = Instance.new("Decal")
            decal.Texture = "rbxassetid://128762649674869"
            decal.Face = face
            decal.Parent = playerFloor
        end
    end
    
    -- تحديث موضع الأرضية تحت اللاعب
    playerFloor.Position = Vector3.new(
        humanoidRootPart.Position.X,
        humanoidRootPart.Position.Y - 4,
        humanoidRootPart.Position.Z
    )
end

-- وظيفة تبديل التشغيل/الإيقاف مع أنيميشن
ToggleButton.MouseButton1Click:Connect(function()
    enabled = not enabled
    
    if enabled then
        TweenService:Create(ToggleButton, TweenInfo.new(0.3), {
            BackgroundColor3 = Color3.fromRGB(60, 220, 60)
        }):Play()
        ToggleButton.Text = "ON"
        
        -- تغيير صورة الزر الدائري عند التشغيل
        task.spawn(function()
            while enabled do
                CircleOpenButton.Image = randomImages[math.random(1, #randomImages)]
                wait(2)
            end
        end)
    else
        TweenService:Create(ToggleButton, TweenInfo.new(0.3), {
            BackgroundColor3 = Color3.fromRGB(220, 60, 60)
        }):Play()
        ToggleButton.Text = "OFF"
        
        -- تنظيف الأرضية عند الإيقاف
        if playerFloor and playerFloor.Parent then
            playerFloor:Destroy()
        end
        playerFloor = nil
    end
end)

-- وظيفة حفظ الموقع الحالي كنقطة ريسباون
SaveSpawnButton.MouseButton1Click:Connect(function()
    local character = LocalPlayer.Character
    if character then
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if humanoidRootPart then
            customSpawnPoint = humanoidRootPart.Position
            TweenService:Create(SaveSpawnButton, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.fromRGB(60, 200, 60)
            }):Play()
            wait(0.3)
            TweenService:Create(SaveSpawnButton, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.fromRGB(80, 120, 200)
            }):Play()
        end
    end
end)

-- وظيفة الجري نحو نقطة الريسباون المحفوظة
TeleportSpawnButton.MouseButton1Click:Connect(function()
    if customSpawnPoint then
        running = not running
        
        if running then
            TweenService:Create(TeleportSpawnButton, TweenInfo.new(0.3), {
                BackgroundColor3 = Color3.fromRGB(60, 200, 60)
            }):Play()
            TeleportSpawnButton.Text = "إيقاف الجري"
        else
            TweenService:Create(TeleportSpawnButton, TweenInfo.new(0.3), {
                BackgroundColor3 = Color3.fromRGB(200, 120, 80)
            }):Play()
            TeleportSpawnButton.Text = "تشغيل الجري"
        end
    else
        TweenService:Create(TeleportSpawnButton, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(200, 80, 80)
        }):Play()
        wait(0.3)
        TweenService:Create(TeleportSpawnButton, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(200, 120, 80)
        }):Play()
    end
end)

-- دالة الجري نحو الهدف
local function runToTarget()
    if running and customSpawnPoint then
        local character = LocalPlayer.Character
        if character then
            local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
            local humanoid = character:FindFirstChild("Humanoid")
            
            if humanoidRootPart and humanoid then
                local direction = (customSpawnPoint - humanoidRootPart.Position).Unit
                humanoidRootPart.Velocity = Vector3.new(
                    direction.X * 35,
                    humanoidRootPart.Velocity.Y,
                    direction.Z * 35
                )
            end
        end
    end
end

-- وظائف الأزرار العلوية
CloseButton.MouseButton1Click:Connect(function()
    hideMainFrame()
end)

ToggleSizeButton.MouseButton1Click:Connect(function()
    minimized = not minimized
    
    if minimized then
        TweenService:Create(MainFrame, TweenInfo.new(0.3), {
            Size = UDim2.new(0, 320, 0, 40)
        }):Play()
        ToggleSizeButton.Text = "+"
        ToggleButton.Visible = false
        SaveSpawnButton.Visible = false
        TeleportSpawnButton.Visible = false
    else
        TweenService:Create(MainFrame, TweenInfo.new(0.3), {
            Size = UDim2.new(0, 320, 0, 250)
        }):Play()
        ToggleSizeButton.Text = "-"
        ToggleButton.Visible = true
        SaveSpawnButton.Visible = true
        TeleportSpawnButton.Visible = true
    end
end)

CircleOpenButton.MouseButton1Click:Connect(function()
    CircleOpenButton.Visible = false
    showMainFrame()
end)

-- أنيميشن للزر الدائري
task.spawn(function()
    while true do
        TweenService:Create(CircleOpenButton, TweenInfo.new(1), {
            Rotation = 5
        }):Play()
        wait(1)
        TweenService:Create(CircleOpenButton, TweenInfo.new(1), {
            Rotation = -5
        }):Play()
        wait(1)
        TweenService:Create(CircleOpenButton, TweenInfo.new(1), {
            Rotation = 0
        }):Play()
        wait(3)
    end
end)

-- تحديث مستمر
RunService.Heartbeat:Connect(function()
    if enabled and LocalPlayer.Character then
        updateFloorUnderPlayer()
    end
    runToTarget()
end)

-- تنظيف الأرضية عند إغلاق السكربت
game:GetService("CoreGui").ChildRemoved:Connect(function(child)
    if child == ScreenGui and playerFloor then
        playerFloor:Destroy()
        playerFloor = nil
    end
end)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local Teams = game:GetService("Teams")

-- إعدادات الهيتبوكس العالمية
_G.HeadSize = 10
_G.Disabled = true

-- إنشاء واجهة الشعار
local LogoGui = Instance.new("ScreenGui")
LogoGui.Name = "LOR_PlayerLogo"
LogoGui.Parent = game.CoreGui
LogoGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
LogoGui.DisplayOrder = 1000

-- وظيفة لعرض شعار دخول اللاعب
local function showPlayerLogo(playerName)
    local logoFrame = Instance.new("Frame")
    logoFrame.Size = UDim2.new(0, 350, 0, 100)
    logoFrame.Position = UDim2.new(0.5, -175, 0.25, 0)
    logoFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
    logoFrame.BackgroundTransparency = 0.1
    logoFrame.Parent = LogoGui
    
    -- تأثيرات الإطار المحسنة
    local frameCorner = Instance.new("UICorner")
    frameCorner.CornerRadius = UDim.new(0, 14)
    frameCorner.Parent = logoFrame
    
    local frameStroke = Instance.new("UIStroke")
    frameStroke.Color = Color3.fromRGB(80, 150, 240)
    frameStroke.Thickness = 2
    frameStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    frameStroke.Parent = logoFrame
    
    -- تأثير توهج خفيف
    local frameGlow = Instance.new("ImageLabel")
    frameGlow.Size = UDim2.new(1.1, 0, 1.1, 0)
    frameGlow.Position = UDim2.new(-0.05, 0, -0.05, 0)
    frameGlow.BackgroundTransparency = 1
    frameGlow.Image = "rbxassetid://7072717779"
    frameGlow.ImageColor3 = Color3.fromRGB(60, 120, 200)
    frameGlow.ImageTransparency = 0.9
    frameGlow.ScaleType = Enum.ScaleType.Slice
    frameGlow.SliceScale = 0.1
    frameGlow.SliceCenter = Rect.new(100, 100, 100, 100)
    frameGlow.ZIndex = 0
    frameGlow.Parent = logoFrame
    
    -- زر الإغلاق (X)
    local closeButton = Instance.new("TextButton")
    closeButton.Size = UDim2.new(0, 24, 0, 24)
    closeButton.Position = UDim2.new(1, -28, 0, 4)
    closeButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.Text = "X"
    closeButton.Font = Enum.Font.GothamBold
    closeButton.TextSize = 16
    closeButton.AutoButtonColor = false
    closeButton.ZIndex = 5
    closeButton.Parent = logoFrame
    
    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(1, 0)
    closeCorner.Parent = closeButton
    
    local closeGradient = Instance.new("UIGradient")
    closeGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(220, 80, 80)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(180, 50, 50))
    }
    closeGradient.Rotation = 90
    closeGradient.Parent = closeButton
    
    local closeStroke = Instance.new("UIStroke")
    closeStroke.Color = Color3.fromRGB(240, 100, 100)
    closeStroke.Thickness = 1.5
    closeStroke.Parent = closeButton
    
    -- شعار LOR
    local logoText = Instance.new("TextLabel")
    logoText.Size = UDim2.new(1, -40, 0.5, 0)
    logoText.Position = UDim2.new(0, 20, 0, 0)
    logoText.Text = "LOR - LORLN"
    logoText.TextColor3 = Color3.fromRGB(220, 220, 230)
    logoText.BackgroundTransparency = 1
    logoText.Font = Enum.Font.GothamBold
    logoText.TextSize = 22
    logoText.TextXAlignment = Enum.TextXAlignment.Left
    logoText.Parent = logoFrame
    
    -- اسم اللاعب
    local playerText = Instance.new("TextLabel")
    playerText.Size = UDim2.new(1, -40, 0.5, 0)
    playerText.Position = UDim2.new(0, 20, 0.5, 0)
    playerText.Text = playerName .. " joined the game"
    playerText.TextColor3 = Color3.fromRGB(200, 200, 210)
    playerText.BackgroundTransparency = 1
    playerText.Font = Enum.Font.Gotham
    playerText.TextSize = 18
    playerText.TextXAlignment = Enum.TextXAlignment.Left
    playerText.Parent = logoFrame
    
    -- أيقونة اللاعب
    local playerIcon = Instance.new("ImageLabel")
    playerIcon.Size = UDim2.new(0, 30, 0, 30)
    playerIcon.Position = UDim2.new(0, -40, 0.25, 0)
    playerIcon.AnchorPoint = Vector2.new(1, 0.5)
    playerIcon.BackgroundTransparency = 1
    playerIcon.Image = "rbxassetid://7072726642"
    playerIcon.ImageColor3 = Color3.fromRGB(80, 150, 240)
    playerIcon.Parent = logoFrame
    
    -- تأثيرات الظهور
    logoFrame.BackgroundTransparency = 1
    logoText.TextTransparency = 1
    playerText.TextTransparency = 1
    playerIcon.ImageTransparency = 1
    closeButton.BackgroundTransparency = 1
    closeButton.TextTransparency = 1
    
    local showTween = TweenService:Create(
        logoFrame,
        TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {BackgroundTransparency = 0.1}
    )
    
    local textShowTween = TweenService:Create(
        logoText,
        TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {TextTransparency = 0}
    )
    
    local playerShowTween = TweenService:Create(
        playerText,
        TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {TextTransparency = 0}
    )
    
    local iconShowTween = TweenService:Create(
        playerIcon,
        TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {ImageTransparency = 0}
    )
    
    local closeShowTween = TweenService:Create(
        closeButton,
        TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {BackgroundTransparency = 0, TextTransparency = 0}
    )
    
    showTween:Play()
    textShowTween:Play()
    playerShowTween:Play()
    iconShowTween:Play()
    closeShowTween:Play()
    
    -- وظيفة إغلاق الشعار
    local function closeLogo()
        local hideTween = TweenService:Create(
            logoFrame,
            TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {BackgroundTransparency = 1}
        )
        
        local textHideTween = TweenService:Create(
            logoText,
            TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {TextTransparency = 1}
        )
        
        local playerHideTween = TweenService:Create(
            playerText,
            TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {TextTransparency = 1}
        )
        
        local iconHideTween = TweenService:Create(
            playerIcon,
            TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {ImageTransparency = 1}
        )
        
        local closeHideTween = TweenService:Create(
            closeButton,
            TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {BackgroundTransparency = 1, TextTransparency = 1}
        )
        
        hideTween:Play()
        textHideTween:Play()
        playerHideTween:Play()
        iconHideTween:Play()
        closeHideTween:Play()
        
        hideTween.Completed:Connect(function()
            logoFrame:Destroy()
        end)
    end
    
    -- إضافة حدث النقر على زر الإغلاق
    closeButton.MouseButton1Click:Connect(closeLogo)
    
    -- تأثيرات التمرير لزر الإغلاق
    closeButton.MouseEnter:Connect(function()
        local tween = TweenService:Create(
            closeButton,
            TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {Size = UDim2.new(0, 26, 0, 26), Position = UDim2.new(1, -29, 0, 3)}
        )
        tween:Play()
    end)
    
    closeButton.MouseLeave:Connect(function()
        local tween = TweenService:Create(
            closeButton,
            TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {Size = UDim2.new(0, 24, 0, 24), Position = UDim2.new(1, -28, 0, 4)}
        )
        tween:Play()
    end)
    
    -- الإغلاق التلقائي بعد 5 ثوان
    delay(5, function()
        if logoFrame and logoFrame.Parent then
            closeLogo()
        end
    end)
end

-- UI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "LOR_AdvancedSystem"
ScreenGui.Parent = game.CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.DisplayOrder = 999

-- الإطار الرئيسي بتصميم LOR المميز والمحسن
local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 350, 0, 380)
Frame.Position = UDim2.new(1, -360, 0.3, 0)
Frame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
Frame.BorderSizePixel = 0
Frame.Active = true

-- تأثيرات الإطار المحسنة
local UICorner = Instance.new("UICorner", Frame)
UICorner.CornerRadius = UDim.new(0, 16)

local frameGradient = Instance.new("UIGradient")
frameGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(20, 20, 25)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(15, 15, 20)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(10, 10, 15))
}
frameGradient.Rotation = -15
frameGradient.Parent = Frame

local frameStroke = Instance.new("UIStroke")
frameStroke.Color = Color3.fromRGB(80, 150, 240)
frameStroke.Thickness = 2
frameStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
frameStroke.Parent = Frame

-- تأثير توهج خفيف للإطار
local frameGlow = Instance.new("ImageLabel")
frameGlow.Size = UDim2.new(1.1, 0, 1.1, 0)
frameGlow.Position = UDim2.new(-0.05, 0, -0.05, 0)
frameGlow.BackgroundTransparency = 1
frameGlow.Image = "rbxassetid://7072717779"
frameGlow.ImageColor3 = Color3.fromRGB(60, 120, 200)
frameGlow.ImageTransparency = 0.85
frameGlow.ScaleType = Enum.ScaleType.Slice
frameGlow.SliceScale = 0.1
frameGlow.SliceCenter = Rect.new(100, 100, 100, 100)
frameGlow.ZIndex = 0
frameGlow.Parent = Frame

-- شريط العنوان LOR - LORLN المحسن
local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1, 0, 0, 35)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.Text = "LOR - ADVANCED SYSTEM"
Title.TextColor3 = Color3.fromRGB(220, 220, 230)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18

local titleGradient = Instance.new("UIGradient")
titleGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(90, 160, 250)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(70, 130, 210))
}
titleGradient.Rotation = 90
titleGradient.Parent = Title

-- شريط السحب المميز
local dragHandle = Instance.new("Frame")
dragHandle.Size = UDim2.new(1, 0, 0, 35)
dragHandle.Position = UDim2.new(0, 0, 0, 0)
dragHandle.BackgroundTransparency = 1
dragHandle.Parent = Frame

local dragIcon = Instance.new("ImageLabel")
dragIcon.Size = UDim2.new(0, 22, 0, 10)
dragIcon.Position = UDim2.new(0.95, 0, 0.5, 0)
dragIcon.AnchorPoint = Vector2.new(0.5, 0.5)
dragIcon.BackgroundTransparency = 1
dragIcon.Image = "rbxassetid://7072726642"
dragIcon.ImageColor3 = Color3.fromRGB(120, 170, 240)
dragIcon.Parent = dragHandle

-- زر التبديل بتصميم LOR المميز والمحسن
local SpectateButton = Instance.new("TextButton", Frame)
SpectateButton.Size = UDim2.new(0.9, 0, 0, 40)
SpectateButton.Position = UDim2.new(0.05, 0, 0, 40)
SpectateButton.Text = "SPECTATE: OFF"
SpectateButton.TextSize = 16
SpectateButton.Font = Enum.Font.GothamBold
SpectateButton.BackgroundColor3 = Color3.fromRGB(180, 0, 0)
SpectateButton.TextColor3 = Color3.new(1, 1, 1)
SpectateButton.AutoButtonColor = false

local SpectateCorner = Instance.new("UICorner", SpectateButton)
SpectateCorner.CornerRadius = UDim.new(0, 12)

local spectateGradient = Instance.new("UIGradient")
spectateGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(200, 50, 50)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(160, 30, 30))
}
spectateGradient.Rotation = 90
spectateGradient.Parent = SpectateButton

local spectateStroke = Instance.new("UIStroke")
spectateStroke.Color = Color3.fromRGB(220, 70, 70)
spectateStroke.Thickness = 1.5
spectateStroke.Parent = SpectateButton

-- أزرار التحكم في الكاميرا المحسنة
local PrevButton = Instance.new("TextButton", Frame)
PrevButton.Size = UDim2.new(0.4, 0, 0, 35)
PrevButton.Position = UDim2.new(0.05, 0, 0, 85)
PrevButton.Text = "◀ PREV"
PrevButton.TextSize = 14
PrevButton.Font = Enum.Font.GothamBold
PrevButton.BackgroundColor3 = Color3.fromRGB(60, 120, 200)
PrevButton.TextColor3 = Color3.new(1, 1, 1)
PrevButton.AutoButtonColor = false

local PrevCorner = Instance.new("UICorner", PrevButton)
PrevCorner.CornerRadius = UDim.new(0, 10)

local prevGradient = Instance.new("UIGradient")
prevGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(70, 140, 220)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(50, 100, 180))
}
prevGradient.Rotation = 90
prevGradient.Parent = PrevButton

local prevStroke = Instance.new("UIStroke")
prevStroke.Color = Color3.fromRGB(100, 150, 220)
prevStroke.Thickness = 1.5
prevStroke.Parent = PrevButton

local NextButton = Instance.new("TextButton", Frame)
NextButton.Size = UDim2.new(0.4, 0, 0, 35)
NextButton.Position = UDim2.new(0.55, 0, 0, 85)
NextButton.Text = "NEXT ▶"
NextButton.TextSize = 14
NextButton.Font = Enum.Font.GothamBold
NextButton.BackgroundColor3 = Color3.fromRGB(60, 120, 200)
NextButton.TextColor3 = Color3.new(1, 1, 1)
NextButton.AutoButtonColor = false

local NextCorner = Instance.new("UICorner", NextButton)
NextCorner.CornerRadius = UDim.new(0, 10)

local nextGradient = Instance.new("UIGradient")
nextGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(70, 140, 220)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(50, 100, 180))
}
nextGradient.Rotation = 90
nextGradient.Parent = NextButton

local nextStroke = Instance.new("UIStroke")
nextStroke.Color = Color3.fromRGB(100, 150, 220)
nextStroke.Thickness = 1.5
nextStroke.Parent = NextButton

-- اسم اللاعب الحالي المحسن
local PlayerText = Instance.new("TextLabel", Frame)
PlayerText.Size = UDim2.new(0.9, 0, 0, 30)
PlayerText.Position = UDim2.new(0.05, 0, 0, 125)
PlayerText.Text = "Current: None"
PlayerText.TextColor3 = Color3.fromRGB(220, 220, 230)
PlayerText.BackgroundTransparency = 1
PlayerText.Font = Enum.Font.Gotham
PlayerText.TextSize = 14
PlayerText.TextXAlignment = Enum.TextXAlignment.Left

-- زر الهيتبوكس المحسن
local HitboxButton = Instance.new("TextButton", Frame)
HitboxButton.Size = UDim2.new(0.9, 0, 0, 35)
HitboxButton.Position = UDim2.new(0.05, 0, 0, 160)
HitboxButton.Text = "HITBOX: OFF"
HitboxButton.TextSize = 14
HitboxButton.Font = Enum.Font.GothamBold
HitboxButton.BackgroundColor3 = Color3.fromRGB(60, 120, 200)
HitboxButton.TextColor3 = Color3.new(1, 1, 1)
HitboxButton.AutoButtonColor = false

local HitboxCorner = Instance.new("UICorner", HitboxButton)
HitboxCorner.CornerRadius = UDim.new(0, 10)

local hitboxGradient = Instance.new("UIGradient")
hitboxGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(70, 140, 220)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(50, 100, 180))
}
hitboxGradient.Rotation = 90
hitboxGradient.Parent = HitboxButton

local hitboxStroke = Instance.new("UIStroke")
hitboxStroke.Color = Color3.fromRGB(100, 150, 220)
hitboxStroke.Thickness = 1.5
hitboxStroke.Parent = HitboxButton

-- أزرار التحكم في حجم الهيتبوكس
local HitboxSizeText = Instance.new("TextLabel", Frame)
HitboxSizeText.Size = UDim2.new(0.4, 0, 0, 25)
HitboxSizeText.Position = UDim2.new(0.05, 0, 0, 200)
HitboxSizeText.Text = "Hitbox Size: " .. _G.HeadSize
HitboxSizeText.TextColor3 = Color3.fromRGB(220, 220, 230)
HitboxSizeText.BackgroundTransparency = 1
HitboxSizeText.Font = Enum.Font.Gotham
HitboxSizeText.TextSize = 14
HitboxSizeText.TextXAlignment = Enum.TextXAlignment.Left

local HitboxIncrease = Instance.new("TextButton", Frame)
HitboxIncrease.Size = UDim2.new(0.2, 0, 0, 25)
HitboxIncrease.Position = UDim2.new(0.45, 0, 0, 200)
HitboxIncrease.Text = "+"
HitboxIncrease.TextSize = 16
HitboxIncrease.Font = Enum.Font.GothamBold
HitboxIncrease.BackgroundColor3 = Color3.fromRGB(60, 120, 200)
HitboxIncrease.TextColor3 = Color3.new(1, 1, 1)
HitboxIncrease.AutoButtonColor = false

local IncreaseCorner = Instance.new("UICorner", HitboxIncrease)
IncreaseCorner.CornerRadius = UDim.new(0, 8)

local HitboxDecrease = Instance.new("TextButton", Frame)
HitboxDecrease.Size = UDim2.new(0.2, 0, 0, 25)
HitboxDecrease.Position = UDim2.new(0.7, 0, 0, 200)
HitboxDecrease.Text = "-"
HitboxDecrease.TextSize = 16
HitboxDecrease.Font = Enum.Font.GothamBold
HitboxDecrease.BackgroundColor3 = Color3.fromRGB(60, 120, 200)
HitboxDecrease.TextColor3 = Color3.new(1, 1, 1)
HitboxDecrease.AutoButtonColor = false

local DecreaseCorner = Instance.new("UICorner", HitboxDecrease)
DecreaseCorner.CornerRadius = UDim.new(0, 8)

-- زر اليم بوت (Aim Bot)
local AimBotButton = Instance.new("TextButton", Frame)
AimBotButton.Size = UDim2.new(0.9, 0, 0, 35)
AimBotButton.Position = UDim2.new(0.05, 0, 0, 230)
AimBotButton.Text = "AIM BOT: OFF"
AimBotButton.TextSize = 14
AimBotButton.Font = Enum.Font.GothamBold
AimBotButton.BackgroundColor3 = Color3.fromRGB(60, 120, 200)
AimBotButton.TextColor3 = Color3.new(1, 1, 1)
AimBotButton.AutoButtonColor = false

local AimBotCorner = Instance.new("UICorner", AimBotButton)
AimBotCorner.CornerRadius = UDim.new(0, 10)

local aimbotGradient = Instance.new("UIGradient")
aimbotGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(70, 140, 220)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(50, 100, 180))
}
aimbotGradient.Rotation = 90
aimbotGradient.Parent = AimBotButton

local aimbotStroke = Instance.new("UIStroke")
aimbotStroke.Color = Color3.fromRGB(100, 150, 220)
aimbotStroke.Thickness = 1.5
aimbotStroke.Parent = AimBotButton

-- إعدادات اليم بوت
local FOVText = Instance.new("TextLabel", Frame)
FOVText.Size = UDim2.new(0.4, 0, 0, 25)
FOVText.Position = UDim2.new(0.05, 0, 0, 270)
FOVText.Text = "FOV Size: 100"
FOVText.TextColor3 = Color3.fromRGB(220, 220, 230)
FOVText.BackgroundTransparency = 1
FOVText.Font = Enum.Font.Gotham
FOVText.TextSize = 14
FOVText.TextXAlignment = Enum.TextXAlignment.Left
FOVText.Parent = Frame

local FOVIncrease = Instance.new("TextButton", Frame)
FOVIncrease.Size = UDim2.new(0.2, 0, 0, 25)
FOVIncrease.Position = UDim2.new(0.45, 0, 0, 270)
FOVIncrease.Text = "+"
FOVIncrease.TextSize = 16
FOVIncrease.Font = Enum.Font.GothamBold
FOVIncrease.BackgroundColor3 = Color3.fromRGB(60, 120, 200)
FOVIncrease.TextColor3 = Color3.new(1, 1, 1)
FOVIncrease.AutoButtonColor = false
FOVIncrease.Parent = Frame

local FOVIncreaseCorner = Instance.new("UICorner", FOVIncrease)
FOVIncreaseCorner.CornerRadius = UDim.new(0, 8)

local FOVDecrease = Instance.new("TextButton", Frame)
FOVDecrease.Size = UDim2.new(0.2, 0, 0, 25)
FOVDecrease.Position = UDim2.new(0.7, 0, 0, 270)
FOVDecrease.Text = "-"
FOVDecrease.TextSize = 16
FOVDecrease.Font = Enum.Font.GothamBold
FOVDecrease.BackgroundColor3 = Color3.fromRGB(60, 120, 200)
FOVDecrease.TextColor3 = Color3.new(1, 1, 1)
FOVDecrease.AutoButtonColor = false
FOVDecrease.Parent = Frame

local FOVDecreaseCorner = Instance.new("UICorner", FOVDecrease)
FOVDecreaseCorner.CornerRadius = UDim.new(0, 8)

-- زر الESP
local ESPButton = Instance.new("TextButton", Frame)
ESPButton.Size = UDim2.new(0.9, 0, 0, 35)
ESPButton.Position = UDim2.new(0.05, 0, 0, 300)
ESPButton.Text = "ESP: OFF"
ESPButton.TextSize = 14
ESPButton.Font = Enum.Font.GothamBold
ESPButton.BackgroundColor3 = Color3.fromRGB(60, 120, 200)
ESPButton.TextColor3 = Color3.new(1, 1, 1)
ESPButton.AutoButtonColor = false

local ESPCorner = Instance.new("UICorner", ESPButton)
ESPCorner.CornerRadius = UDim.new(0, 10)

local espGradient = Instance.new("UIGradient")
espGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(70, 140, 220)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(50, 100, 180))
}
espGradient.Rotation = 90
espGradient.Parent = ESPButton

local espStroke = Instance.new("UIStroke")
espStroke.Color = Color3.fromRGB(100, 150, 220)
espStroke.Thickness = 1.5
espStroke.Parent = ESPButton

-- زر التصغير المتطور المحسن
local minimizeButton = Instance.new("TextButton")
minimizeButton.Size = UDim2.new(0, 24, 0, 24)
minimizeButton.Position = UDim2.new(0.92, 0, 0.02, 0)
minimizeButton.BackgroundColor3 = Color3.fromRGB(60, 120, 200)
minimizeButton.TextColor3 = Color3.fromRGB(220, 220, 230)
minimizeButton.Text = "_"
minimizeButton.Font = Enum.Font.GothamBold
minimizeButton.TextSize = 18
minimizeButton.AutoButtonColor = false
minimizeButton.Parent = Frame

local minimizeCorner = Instance.new("UICorner")
minimizeCorner.CornerRadius = UDim.new(1, 0)
minimizeCorner.Parent = minimizeButton

local minimizeGradient = Instance.new("UIGradient")
minimizeGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(80, 140, 220)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(60, 100, 180))
}
minimizeGradient.Rotation = 90
minimizeGradient.Parent = minimizeButton

local minimizeStroke = Instance.new("UIStroke")
minimizeStroke.Color = Color3.fromRGB(100, 150, 220)
minimizeStroke.Thickness = 1
minimizeStroke.Parent = minimizeButton

-- Variables
local spectateEnabled = false
local hitboxEnabled = false
local aimbotEnabled = false
local espEnabled = false
local currentPlayerIndex = 1
local playersList = {}
local camera = workspace.CurrentCamera

-- إعدادات اليم بوت المحسنة
local fov = 100
local maxTransparency = 0.1
local FOVring = Drawing.new("Circle")
FOVring.Visible = false
FOVring.Thickness = 2
FOVring.Color = Color3.fromRGB(128, 0, 128)
FOVring.Filled = false
FOVring.Radius = fov
FOVring.Position = camera.ViewportSize / 2
FOVring.Transparency = 0.1

-- إعدادات الESP
local ESPHighlights = {}

-- تأثيرات عند التمرير
local hoverTweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
local clickTweenInfo = TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
local smoothTweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

-- Function to Update Hitbox
local function updateHitbox()
    if not _G.Disabled then return end
    
    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
            pcall(function()
                local hrp = v.Character.HumanoidRootPart
                hrp.Size = Vector3.new(_G.HeadSize, _G.HeadSize, _G.HeadSize)
                hrp.Transparency = 0.7
                hrp.BrickColor = BrickColor.new("Really blue")
                hrp.Material = Enum.Material.Neon
                hrp.CanCollide = false
                
                -- تأثير توهج للهيتبوكس
                local glow = hrp:FindFirstChild("HitboxGlow") or Instance.new("PointLight")
                glow.Name = "HitboxGlow"
                glow.Brightness = 1
                glow.Range = _G.HeadSize * 2
                glow.Color = Color3.new(0, 0, 1)
                glow.Parent = hrp
            end)
        end
    end
end

-- Function to Reset Hitboxes
local function resetHitboxes()
    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
            pcall(function()
                local hrp = v.Character.HumanoidRootPart
                hrp.Size = Vector3.new(2, 2, 1)
                hrp.Transparency = 0
                hrp.BrickColor = BrickColor.new("Medium stone grey")
                hrp.Material = Enum.Material.Plastic
                hrp.CanCollide = true
                
                -- إزالة تأثير التوهج
                local glow = hrp:FindFirstChild("HitboxGlow")
                if glow then
                    glow:Destroy()
                end
            end)
        end
    end
end

-- Function to update players list
local function updatePlayersList()
    playersList = {}
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            table.insert(playersList, player)
        end
    end
end

-- Function to spectate player
local function spectatePlayer(index)
    if #playersList == 0 then 
        PlayerText.Text = "Current: None"
        return 
    end
    
    if index < 1 then
        index = #playersList
    elseif index > #playersList then
        index = 1
    end
    
    currentPlayerIndex = index
    local player = playersList[currentPlayerIndex]
    
    if player and player.Character and player.Character:FindFirstChild("Humanoid") then
        camera.CameraSubject = player.Character.Humanoid
        PlayerText.Text = "Current: " .. player.Name
    else
        PlayerText.Text = "Current: None"
    end
end

-- Function to stop spectating
local function stopSpectating()
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        camera.CameraSubject = LocalPlayer.Character.Humanoid
    end
    PlayerText.Text = "Current: None"
end

-- Function for Aim Bot
local function updateDrawings()
    local camViewportSize = camera.ViewportSize
    FOVring.Position = camViewportSize / 2
end

local function lookAt(target)
    local lookVector = (target - camera.CFrame.Position).unit
    local newCFrame = CFrame.new(camera.CFrame.Position, camera.CFrame.Position + lookVector)
    camera.CFrame = newCFrame
end

local function calculateTransparency(distance)
    local maxDistance = fov
    local transparency = (1 - (distance / maxDistance)) * maxTransparency
    return transparency
end

local function getClosestPlayerInFOV(trg_part)
    local nearest = nil
    local last = math.huge
    local playerMousePos = camera.ViewportSize / 2
    local localPlayer = Players.LocalPlayer
    local localPlayerTeam = localPlayer.Team

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= localPlayer then
            local part = player.Character and player.Character:FindFirstChild(trg_part)
            if part then
                local ePos, isVisible = camera:WorldToViewportPoint(part.Position)
                local distance = (Vector2.new(ePos.x, ePos.y) - playerMousePos).Magnitude

                if isVisible and distance < fov and player.Team ~= localPlayerTeam then
                    if distance < last then
                        last = distance
                        nearest = player
                    end
                end
            end
        end
    end

    return nearest
end

local function aimAtNearestPlayer()
    if not aimbotEnabled then return end
    
    updateDrawings()
    local closest = getClosestPlayerInFOV("Head")
    if closest and closest.Character:FindFirstChild("Head") then
        lookAt(closest.Character.Head.Position)

        if closest then
            local ePos, isVisible = camera:WorldToViewportPoint(closest.Character.Head.Position)
            local distance = (Vector2.new(ePos.x, ePos.y) - (camera.ViewportSize / 2)).Magnitude
            FOVring.Transparency = calculateTransparency(distance)
        else
            FOVring.Transparency = 0.1
        end
    else
        FOVring.Transparency = 0.1
    end
end

-- Function for ESP
local function updateESP()
    if not espEnabled then return end
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            if not ESPHighlights[player] then
                local highlight = Instance.new("Highlight")
                highlight.Name = "LORESP"
                highlight.FillColor = Color3.fromRGB(0, 100, 255)
                highlight.FillTransparency = 0.5
                highlight.OutlineColor = Color3.fromRGB(0, 150, 255)
                highlight.OutlineTransparency = 0
                highlight.Parent = player.Character
                ESPHighlights[player] = highlight
            end
        elseif ESPHighlights[player] then
            ESPHighlights[player]:Destroy()
            ESPHighlights[player] = nil
        end
    end
end

local function clearESP()
    for player, highlight in pairs(ESPHighlights) do
        highlight:Destroy()
        ESPHighlights[player] = nil
    end
end

-- تحديث قائمة اللاعبين
updatePlayersList()

-- تأثيرات عند التمرير فوق الأزرار
SpectateButton.MouseEnter:Connect(function()
    local targetColor = spectateEnabled and Color3.fromRGB(80, 180, 80) or Color3.fromRGB(200, 60, 60)
    local tween = TweenService:Create(
        SpectateButton,
        hoverTweenInfo,
        {BackgroundColor3 = targetColor}
    )
    tween:Play()
end)

SpectateButton.MouseLeave:Connect(function()
    local targetColor = spectateEnabled and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(180, 0, 0)
    local tween = TweenService:Create(
        SpectateButton,
        hoverTweenInfo,
        {BackgroundColor3 = targetColor}
    )
    tween:Play()
end)

PrevButton.MouseEnter:Connect(function()
    local tween = TweenService:Create(
        PrevButton,
        hoverTweenInfo,
        {BackgroundColor3 = Color3.fromRGB(80, 160, 240)}
    )
    tween:Play()
end)

PrevButton.MouseLeave:Connect(function()
    local tween = TweenService:Create(
        PrevButton,
        hoverTweenInfo,
        {BackgroundColor3 = Color3.fromRGB(60, 120, 200)}
    )
    tween:Play()
end)

NextButton.MouseEnter:Connect(function()
    local tween = TweenService:Create(
        NextButton,
        hoverTweenInfo,
        {BackgroundColor3 = Color3.fromRGB(80, 160, 240)}
    )
    tween:Play()
end)

NextButton.MouseLeave:Connect(function()
    local tween = TweenService:Create(
        NextButton,
        hoverTweenInfo,
        {BackgroundColor3 = Color3.fromRGB(60, 120, 200)}
    )
    tween:Play()
end)

HitboxButton.MouseEnter:Connect(function()
    local targetColor = hitboxEnabled and Color3.fromRGB(80, 180, 80) or Color3.fromRGB(80, 160, 240)
    local tween = TweenService:Create(
        HitboxButton,
        hoverTweenInfo,
        {BackgroundColor3 = targetColor}
    )
    tween:Play()
end)

HitboxButton.MouseLeave:Connect(function()
    local targetColor = hitboxEnabled and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(60, 120, 200)
    local tween = TweenService:Create(
        HitboxButton,
        hoverTweenInfo,
        {BackgroundColor3 = targetColor}
    )
    tween:Play()
end)

HitboxIncrease.MouseEnter:Connect(function()
    local tween = TweenService:Create(
        HitboxIncrease,
        hoverTweenInfo,
        {BackgroundColor3 = Color3.fromRGB(80, 160, 240)}
    )
    tween:Play()
end)

HitboxIncrease.MouseLeave:Connect(function()
    local tween = TweenService:Create(
        HitboxIncrease,
        hoverTweenInfo,
        {BackgroundColor3 = Color3.fromRGB(60, 120, 200)}
    )
    tween:Play()
end)

HitboxDecrease.MouseEnter:Connect(function()
    local tween = TweenService:Create(
        HitboxDecrease,
        hoverTweenInfo,
        {BackgroundColor3 = Color3.fromRGB(80, 160, 240)}
    )
    tween:Play()
end)

HitboxDecrease.MouseLeave:Connect(function()
    local tween = TweenService:Create(
        HitboxDecrease,
        hoverTweenInfo,
        {BackgroundColor3 = Color3.fromRGB(60, 120, 200)}
    )
    tween:Play()
end)

AimBotButton.MouseEnter:Connect(function()
    local targetColor = aimbotEnabled and Color3.fromRGB(80, 180, 80) or Color3.fromRGB(80, 160, 240)
    local tween = TweenService:Create(
        AimBotButton,
        hoverTweenInfo,
        {BackgroundColor3 = targetColor}
    )
    tween:Play()
end)

AimBotButton.MouseLeave:Connect(function()
    local targetColor = aimbotEnabled and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(60, 120, 200)
    local tween = TweenService:Create(
        AimBotButton,
        hoverTweenInfo,
        {BackgroundColor3 = targetColor}
    )
    tween:Play()
end)

FOVIncrease.MouseEnter:Connect(function()
    local tween = TweenService:Create(
        FOVIncrease,
        hoverTweenInfo,
        {BackgroundColor3 = Color3.fromRGB(80, 160, 240)}
    )
    tween:Play()
end)

FOVIncrease.MouseLeave:Connect(function()
    local tween = TweenService:Create(
        FOVIncrease,
        hoverTweenInfo,
        {BackgroundColor3 = Color3.fromRGB(60, 120, 200)}
    )
    tween:Play()
end)

FOVDecrease.MouseEnter:Connect(function()
    local tween = TweenService:Create(
        FOVDecrease,
        hoverTweenInfo,
        {BackgroundColor3 = Color3.fromRGB(80, 160, 240)}
    )
    tween:Play()
end)

FOVDecrease.MouseLeave:Connect(function()
    local tween = TweenService:Create(
        FOVDecrease,
        hoverTweenInfo,
        {BackgroundColor3 = Color3.fromRGB(60, 120, 200)}
    )
    tween:Play()
end)

ESPButton.MouseEnter:Connect(function()
    local targetColor = espEnabled and Color3.fromRGB(80, 180, 80) or Color3.fromRGB(80, 160, 240)
    local tween = TweenService:Create(
        ESPButton,
        hoverTweenInfo,
        {BackgroundColor3 = targetColor}
    )
    tween:Play()
end)

ESPButton.MouseLeave:Connect(function()
    local targetColor = espEnabled and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(60, 120, 200)
    local tween = TweenService:Create(
        ESPButton,
        hoverTweenInfo,
        {BackgroundColor3 = targetColor}
    )
    tween:Play()
end)

minimizeButton.MouseEnter:Connect(function()
    local tween = TweenService:Create(
        minimizeButton,
        hoverTweenInfo,
        {BackgroundColor3 = Color3.fromRGB(80, 140, 220), Size = UDim2.new(0, 26, 0, 26)}
    )
    tween:Play()
end)

minimizeButton.MouseLeave:Connect(function()
    local tween = TweenService:Create(
        minimizeButton,
        hoverTweenInfo,
        {BackgroundColor3 = Color3.fromRGB(60, 120, 200), Size = UDim2.new(0, 24, 0, 24)}
    )
    tween:Play()
end)

-- Toggle Spectate Function
SpectateButton.MouseButton1Click:Connect(function()
    spectateEnabled = not spectateEnabled
    if spectateEnabled then
        SpectateButton.Text = "SPECTATE: ON"
        
        local tween = TweenService:Create(
            SpectateButton,
            smoothTweenInfo,
            {BackgroundColor3 = Color3.fromRGB(0, 150, 0)}
        )
        tween:Play()
        
        updatePlayersList()
        spectatePlayer(currentPlayerIndex)
    else
        SpectateButton.Text = "SPECTATE: OFF"
        
        local tween = TweenService:Create(
            SpectateButton,
            smoothTweenInfo,
            {BackgroundColor3 = Color3.fromRGB(180, 0, 0)}
        )
        tween:Play()
        
        stopSpectating()
    end
end)

-- Previous Player Function
PrevButton.MouseButton1Click:Connect(function()
    if spectateEnabled then
        currentPlayerIndex = currentPlayerIndex - 1
        spectatePlayer(currentPlayerIndex)
    end
end)

-- Next Player Function
NextButton.MouseButton1Click:Connect(function()
    if spectateEnabled then
        currentPlayerIndex = currentPlayerIndex + 1
        spectatePlayer(currentPlayerIndex)
    end
end)

-- Toggle Hitbox Function
HitboxButton.MouseButton1Click:Connect(function()
    hitboxEnabled = not hitboxEnabled
    _G.Disabled = hitboxEnabled
    
    if hitboxEnabled then
        HitboxButton.Text = "HITBOX: ON"
        
        local tween = TweenService:Create(
            HitboxButton,
            smoothTweenInfo,
            {BackgroundColor3 = Color3.fromRGB(0, 150, 0)}
        )
        tween:Play()
        
        updateHitbox()
    else
        HitboxButton.Text = "HITBOX: OFF"
        
        local tween = TweenService:Create(
            HitboxButton,
            smoothTweenInfo,
            {BackgroundColor3 = Color3.fromRGB(60, 120, 200)}
        )
        tween:Play()
        
        resetHitboxes()
    end
end)

-- Increase Hitbox Size
HitboxIncrease.MouseButton1Click:Connect(function()
    _G.HeadSize = _G.HeadSize + 1
    HitboxSizeText.Text = "Hitbox Size: " .. _G.HeadSize
    if hitboxEnabled then
        updateHitbox()
    end
end)

-- Decrease Hitbox Size
HitboxDecrease.MouseButton1Click:Connect(function()
    if _G.HeadSize > 1 then
        _G.HeadSize = _G.HeadSize - 1
        HitboxSizeText.Text = "Hitbox Size: " .. _G.HeadSize
        if hitboxEnabled then
            updateHitbox()
        end
    end
end)

-- Toggle Aim Bot Function
AimBotButton.MouseButton1Click:Connect(function()
    aimbotEnabled = not aimbotEnabled
    
    if aimbotEnabled then
        AimBotButton.Text = "AIM BOT: ON"
        FOVring.Visible = true
        
        local tween = TweenService:Create(
            AimBotButton,
            smoothTweenInfo,
            {BackgroundColor3 = Color3.fromRGB(0, 150, 0)}
        )
        tween:Play()
    else
        AimBotButton.Text = "AIM BOT: OFF"
        FOVring.Visible = false
        
        local tween = TweenService:Create(
            AimBotButton,
            smoothTweenInfo,
            {BackgroundColor3 = Color3.fromRGB(60, 120, 200)}
        )
        tween:Play()
    end
end)

-- Increase FOV Size
FOVIncrease.MouseButton1Click:Connect(function()
    fov = math.min(fov + 10, 300)
    FOVring.Radius = fov
    FOVText.Text = "FOV Size: " .. fov
end)

-- Decrease FOV Size
FOVDecrease.MouseButton1Click:Connect(function()
    fov = math.max(fov - 10, 30)
    FOVring.Radius = fov
    FOVText.Text = "FOV Size: " .. fov
end)

-- Toggle ESP Function
ESPButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    
    if espEnabled then
        ESPButton.Text = "ESP: ON"
        
        local tween = TweenService:Create(
            ESPButton,
            smoothTweenInfo,
            {BackgroundColor3 = Color3.fromRGB(0, 150, 0)}
        )
        tween:Play()
        
        updateESP()
    else
        ESPButton.Text = "ESP: OFF"
        
        local tween = TweenService:Create(
            ESPButton,
            smoothTweenInfo,
            {BackgroundColor3 = Color3.fromRGB(60, 120, 200)}
        )
        tween:Play()
        
        clearESP()
    end
end)

-- وظيفة التصغير
local isMinimized = false
minimizeButton.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    
    if isMinimized then
        -- تأثير تصغير مع الرسوم المتحركة
        local tween = TweenService:Create(
            Frame,
            TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
            {Size = UDim2.new(0, 350, 0, 35)}
        )
        tween:Play()
        
        minimizeButton.Text = "+"
        
        -- إخفاء المحتوى تدريجياً
        SpectateButton.Visible = false
        PrevButton.Visible = false
        NextButton.Visible = false
        PlayerText.Visible = false
        HitboxButton.Visible = false
        HitboxSizeText.Visible = false
        HitboxIncrease.Visible = false
        HitboxDecrease.Visible = false
        AimBotButton.Visible = false
        FOVText.Visible = false
        FOVIncrease.Visible = false
        FOVDecrease.Visible = false
        ESPButton.Visible = false
    else
        -- تأثير إعادة التكبير مع الرسوم المتحركة
        local tween = TweenService:Create(
            Frame,
            TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
            {Size = UDim2.new(0, 350, 0, 380)}
        )
        tween:Play()
        
        minimizeButton.Text = "_"
        
        -- إظهار المحتوى بعد التأثير
        delay(0.3, function()
            SpectateButton.Visible = true
            PrevButton.Visible = true
            NextButton.Visible = true
            PlayerText.Visible = true
            HitboxButton.Visible = true
            HitboxSizeText.Visible = true
            HitboxIncrease.Visible = true
            HitboxDecrease.Visible = true
            AimBotButton.Visible = true
            FOVText.Visible = true
            FOVIncrease.Visible = true
            FOVDecrease.Visible = true
            ESPButton.Visible = true
        end)
    end
end)

-- وظيفة السحب المتطورة
local dragging = false
local dragInput, dragStart, startPos

local function update(input)
    local delta = input.Position - dragStart
    local newX = startPos.X.Offset + delta.X
    local newY = startPos.Y.Offset + delta.Y
    
    -- التأكد من بقاء الإطار داخل الشاشة
    newX = math.clamp(newX, 0, ScreenGui.AbsoluteSize.X - Frame.AbsoluteSize.X)
    newY = math.clamp(newY, 0, ScreenGui.AbsoluteSize.Y - Frame.AbsoluteSize.Y)
    
    Frame.Position = UDim2.new(0, newX, 0, newY)
end

dragHandle.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = Frame.Position
        
        -- تأثير عند السحب
        local tween = TweenService:Create(
            Frame,
            TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {BackgroundColor3 = Color3.fromRGB(25, 25, 30)}
        )
        tween:Play()
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
                
                -- إعادة اللون بعد السحب
                local tween = TweenService:Create(
                    Frame,
                    TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                    {BackgroundColor3 = Color3.fromRGB(15, 15, 20)}
                )
                tween:Play()
            end
        end)
    end
end)

dragHandle.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Update Hitbox on Render
RunService.RenderStepped:Connect(function()
    if hitboxEnabled then
        updateHitbox()
    end
    
    if aimbotEnabled then
        aimAtNearestPlayer()
    end
    
    if espEnabled then
        updateESP()
    end
end)

-- اختصارات لوحة المفاتيح
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.H and UserInputService:IsKeyDown(Enum.KeyCode.LeftAlt) then
        HitboxButton.MouseButton1Click()
    elseif input.KeyCode == Enum.KeyCode.S and UserInputService:IsKeyDown(Enum.KeyCode.LeftAlt) then
        SpectateButton.MouseButton1Click()
    elseif input.KeyCode == Enum.KeyCode.LeftBracket and spectateEnabled then
        PrevButton.MouseButton1Click()
    elseif input.KeyCode == Enum.KeyCode.RightBracket and spectateEnabled then
        NextButton.MouseButton1Click()
    elseif input.KeyCode == Enum.KeyCode.A and UserInputService:IsKeyDown(Enum.KeyCode.LeftAlt) then
        AimBotButton.MouseButton1Click()
    elseif input.KeyCode == Enum.KeyCode.E and UserInputService:IsKeyDown(Enum.KeyCode.LeftAlt) then
        ESPButton.MouseButton1Click()
    elseif input.KeyCode == Enum.KeyCode.Delete then
        if aimbotEnabled then
            FOVring.Visible = false
        end
    end
end)

-- تحديث قائمة اللاعبين عند دخول أو خروج لاعب
Players.PlayerAdded:Connect(function(player)
    updatePlayersList()
    if spectateEnabled then
        spectatePlayer(currentPlayerIndex)
    end
end)

Players.PlayerRemoving:Connect(function(player)
    updatePlayersList()
    if spectateEnabled then
        spectatePlayer(currentPlayerIndex)
    end
    if ESPHighlights[player] then
        ESPHighlights[player]:Destroy()
        ESPHighlights[player] = nil
    end
end)

-- تنظيف الESP عند إغلاق اللعبة
game:GetService("CoreGui").ChildRemoved:Connect(function(child)
    if child.Name == "LOR_AdvancedSystem" then
        clearESP()
        if FOVring then
            FOVring:Remove()
        end
    end
end)

-- عرض شعار لجميع اللاعبين الموجودين عند التشغيل
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        showPlayerLogo(player.Name)
        wait(0.5) -- تأخير بين كل شعار
    end
end

print("تم تحميل نظام LOR المتكامل المحسن بنجاح!")
print("مميزات النظام: المشاهدة، الهيتبوكس، اليم بوت، ESP")
print("الاختصارات: Alt+H - الهيتبوكس, Alt+S - المشاهدة, Alt+A - اليم بوت, Alt+E - ESP")

