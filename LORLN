local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local SoundService = game:GetService("SoundService")
local MarketplaceService = game:GetService("MarketplaceService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local blacklist = {
    ["uojooxx"] = true,
    ["ÿπŸÑŸä ÿ≠ÿ±ÿßŸÖŸä ÿ¨ŸÜÿßŸÜ ÿßŸÑŸÇÿ≠ÿ®Ÿá"] = true,
    ["ŸäŸàÿ≥ŸÅ ÿßŸÑŸÇÿ≠ÿ®Ÿá ÿßŸÑŸÖÿπÿ≤ÿ≤"] = true,
    ["ÿ≠ÿ®Ÿäÿ®ÿ™Ÿá ÿßŸÑÿ¥Ÿäÿ∑ÿßŸÜŸá"] = true,
    ["aaaaad"] = true
}

task.wait(1)
if blacklist[player.Name] then
    player:Kick("üö´")
    return
end

local THEME = {
    Primary = Color3.fromRGB(10, 0, 0),
    Secondary = Color3.fromRGB(25, 0, 0),
    Accent = Color3.fromRGB(255, 40, 40),
    Text = Color3.fromRGB(255, 255, 255),
    Success = Color3.fromRGB(60, 200, 120),
    Error = Color3.fromRGB(255, 80, 80),
    Warning = Color3.fromRGB(255, 170, 0)
}

local function playSound(id)
    local s = Instance.new("Sound")
    s.SoundId = "rbxassetid://" .. id
    s.Volume = 1
    s.Parent = SoundService
    s:Play()
    s.Ended:Once(function()
        s:Destroy()
    end)
end

local CLICK_SOUND = 12221967

local function checkGamePassOwnership()
    local success, ownsPass = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(player.UserId, 1608444260)
    end)
    return success and ownsPass
end

local KeyValidator = {
    rawUrl = "https://raw.githubusercontent.com/LORLN9/LORLN-PRO/refs/heads/main/Key",
    currentValidKeys = {},
    isChecking = false
}

function KeyValidator.fetchCurrentKeys()
    local success, result = pcall(function()
        local response = game:HttpGet(KeyValidator.rawUrl, true)
        local keys = {}
        for line in response:gmatch("[^\r\n]+") do
            local cleanLine = line:gsub("%s+", ""):upper()
            if cleanLine ~= "" and #cleanLine > 3 then
                keys[cleanLine] = true
            end
        end
        return keys
    end)
    
    if success then
        KeyValidator.currentValidKeys = result
        return result
    end
    
    return nil
end

function KeyValidator.checkKeyValid(key)
    local keys = KeyValidator.fetchCurrentKeys()
    if not keys then return false end
    return keys[key:upper()] == true
end

local function createKeySystem()
    local keyWindow = Instance.new("ScreenGui", playerGui)
    keyWindow.Name = "LORLN_KEY_VERIFICATION"
    keyWindow.ResetOnSpawn = false
    keyWindow.DisplayOrder = 9999

    local Main = Instance.new("Frame", keyWindow)
    Main.Size = UDim2.new(0, 400, 0, 350)
    Main.Position = UDim2.new(0.5, -200, 0.5, -175)
    Main.BackgroundColor3 = THEME.Primary
    Main.BorderSizePixel = 0
    Main.Active = true
    Main.Selectable = true

    local MainCorner = Instance.new("UICorner", Main)
    MainCorner.CornerRadius = UDim.new(0, 14)

    local MainStroke = Instance.new("UIStroke", Main)
    MainStroke.Color = THEME.Accent
    MainStroke.Thickness = 2

    local Header = Instance.new("Frame", Main)
    Header.Size = UDim2.new(1, 0, 0, 60)
    Header.BackgroundColor3 = THEME.Secondary
    Header.BorderSizePixel = 0
    Header.Active = true
    Header.Selectable = true

    local HeaderCorner = Instance.new("UICorner", Header)
    HeaderCorner.CornerRadius = UDim.new(0, 14, 0, 0)

    local Logo = Instance.new("ImageLabel", Header)
    Logo.Size = UDim2.new(0, 45, 0, 45)
    Logo.Position = UDim2.new(0, 10, 0.5, -22.5)
    Logo.Image = "rbxassetid://131690304470847"
    Logo.BackgroundTransparency = 1

    local Title = Instance.new("TextLabel", Header)
    Title.Position = UDim2.new(0, 65, 0, 10)
    Title.Size = UDim2.new(1, -75, 0, 25)
    Title.Text = "LORLN PRO ACCESS"
    Title.Font = Enum.Font.GothamBlack
    Title.TextSize = 20
    Title.TextColor3 = THEME.Text
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.BackgroundTransparency = 1

    local Subtitle = Instance.new("TextLabel", Header)
    Subtitle.Position = UDim2.new(0, 65, 0, 35)
    Subtitle.Size = UDim2.new(1, -75, 0, 20)
    Subtitle.Text = "Premium Key Required"
    Subtitle.Font = Enum.Font.GothamMedium
    Subtitle.TextSize = 12
    Subtitle.TextColor3 = THEME.Accent
    Subtitle.TextXAlignment = Enum.TextXAlignment.Left
    Subtitle.BackgroundTransparency = 1

    local Content = Instance.new("Frame", Main)
    Content.Position = UDim2.new(0, 0, 0, 60)
    Content.Size = UDim2.new(1, 0, 1, -60)
    Content.BackgroundTransparency = 1

    local Step1 = Instance.new("TextLabel", Content)
    Step1.Position = UDim2.new(0, 30, 0, 15)
    Step1.Size = UDim2.new(1, -60, 0, 25)
    Step1.Text = "üìù Step 1: Get key from website"
    Step1.Font = Enum.Font.GothamBold
    Step1.TextSize = 14
    Step1.TextColor3 = THEME.Text
    Step1.TextXAlignment = Enum.TextXAlignment.Left
    Step1.BackgroundTransparency = 1

    local LinkBox = Instance.new("Frame", Content)
    LinkBox.Size = UDim2.new(1, -60, 0, 40)
    LinkBox.Position = UDim2.new(0, 30, 0, 45)
    LinkBox.BackgroundColor3 = THEME.Secondary
    LinkBox.BorderSizePixel = 0

    local LinkBoxCorner = Instance.new("UICorner", LinkBox)
    LinkBoxCorner.CornerRadius = UDim.new(0, 8)

    local LinkText = Instance.new("TextLabel", LinkBox)
    LinkText.Position = UDim2.new(0, 15, 0, 0)
    LinkText.Size = UDim2.new(1, -120, 1, 0)
    LinkText.Text = "direct-link.net/2641180/WPYEBwWoffCI"
    LinkText.Font = Enum.Font.Gotham
    LinkText.TextSize = 13
    LinkText.TextColor3 = THEME.Text
    LinkText.TextXAlignment = Enum.TextXAlignment.Left
    LinkText.BackgroundTransparency = 1

    local CopyBtn = Instance.new("TextButton", LinkBox)
    CopyBtn.Size = UDim2.new(0, 100, 0, 32)
    CopyBtn.Position = UDim2.new(1, -110, 0.5, -16)
    CopyBtn.Text = "COPY LINK"
    CopyBtn.Font = Enum.Font.GothamBold
    CopyBtn.TextSize = 12
    CopyBtn.TextColor3 = THEME.Text
    CopyBtn.BackgroundColor3 = THEME.Accent
    CopyBtn.BorderSizePixel = 0

    local CopyBtnCorner = Instance.new("UICorner", CopyBtn)
    CopyBtnCorner.CornerRadius = UDim.new(0, 6)

    local Step2 = Instance.new("TextLabel", Content)
    Step2.Position = UDim2.new(0, 30, 0, 100)
    Step2.Size = UDim2.new(1, -60, 0, 25)
    Step2.Text = "üîë Step 2: Enter your key below"
    Step2.Font = Enum.Font.GothamBold
    Step2.TextSize = 14
    Step2.TextColor3 = THEME.Text
    Step2.TextXAlignment = Enum.TextXAlignment.Left
    Step2.BackgroundTransparency = 1

    local KeyInput = Instance.new("TextBox", Content)
    KeyInput.Size = UDim2.new(1, -60, 0, 50)
    KeyInput.Position = UDim2.new(0, 30, 0, 130)
    KeyInput.PlaceholderText = "Paste your key here..."
    KeyInput.Text = ""
    KeyInput.Font = Enum.Font.Gotham
    KeyInput.TextSize = 16
    KeyInput.TextColor3 = THEME.Text
    KeyInput.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
    KeyInput.BackgroundColor3 = THEME.Secondary
    KeyInput.BorderSizePixel = 0
    KeyInput.ClearTextOnFocus = false
    KeyInput.TextEditable = true

    local KeyInputCorner = Instance.new("UICorner", KeyInput)
    KeyInputCorner.CornerRadius = UDim.new(0, 8)

    local KeyInputStroke = Instance.new("UIStroke", KeyInput)
    KeyInputStroke.Color = Color3.fromRGB(80, 0, 0)
    KeyInputStroke.Thickness = 2

    local ExecuteBtn = Instance.new("TextButton", Content)
    ExecuteBtn.Name = "ExecuteButton"
    ExecuteBtn.Size = UDim2.new(1, -60, 0, 45)
    ExecuteBtn.Position = UDim2.new(0, 30, 0, 195)
    ExecuteBtn.Text = "EXECUTE"
    ExecuteBtn.Font = Enum.Font.GothamBold
    ExecuteBtn.TextSize = 16
    ExecuteBtn.TextColor3 = THEME.Text
    ExecuteBtn.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
    ExecuteBtn.BorderSizePixel = 0

    local ExecuteBtnCorner = Instance.new("UICorner", ExecuteBtn)
    ExecuteBtnCorner.CornerRadius = UDim.new(0, 8)

    local ExecuteBtnStroke = Instance.new("UIStroke", ExecuteBtn)
    ExecuteBtnStroke.Color = Color3.fromRGB(0, 150, 255)
    ExecuteBtnStroke.Thickness = 2

    local GamePassBtn = Instance.new("TextButton", Content)
    GamePassBtn.Size = UDim2.new(1, -60, 0, 40)
    GamePassBtn.Position = UDim2.new(0, 30, 0, 250)
    GamePassBtn.Text = "üéÆ BUY GAMEPASS (SKIP KEY)"
    GamePassBtn.Font = Enum.Font.GothamBold
    GamePassBtn.TextSize = 14
    GamePassBtn.TextColor3 = THEME.Text
    GamePassBtn.BackgroundColor3 = Color3.fromRGB(0, 80, 150)
    GamePassBtn.BorderSizePixel = 0

    local GamePassBtnCorner = Instance.new("UICorner", GamePassBtn)
    GamePassBtnCorner.CornerRadius = UDim.new(0, 8)

    local GamePassBtnStroke = Instance.new("UIStroke", GamePassBtn)
    GamePassBtnStroke.Color = Color3.fromRGB(0, 120, 200)
    GamePassBtnStroke.Thickness = 2

    local StatusLabel = Instance.new("TextLabel", Content)
    StatusLabel.Size = UDim2.new(1, -60, 0, 20)
    StatusLabel.Position = UDim2.new(0, 30, 1, -45)
    StatusLabel.Text = ""
    StatusLabel.Font = Enum.Font.Gotham
    StatusLabel.TextSize = 12
    StatusLabel.TextColor3 = THEME.Text
    StatusLabel.TextXAlignment = Enum.TextXAlignment.Center
    StatusLabel.BackgroundTransparency = 1

    local directLink = "https://direct-link.net/2641180/WPYEBwWoffCI"
    local verified = false

    local function copyToClipboard(text)
        if setclipboard then
            setclipboard(text)
            return true
        elseif writeclipboard then
            writeclipboard(text)
            return true
        end
        return false
    end

    CopyBtn.MouseButton1Click:Connect(function()
        playSound(CLICK_SOUND)
        if copyToClipboard(directLink) then
            CopyBtn.Text = "‚úì COPIED"
            CopyBtn.BackgroundColor3 = THEME.Success
            StatusLabel.Text = "Link copied!"
            StatusLabel.TextColor3 = THEME.Success
            
            task.wait(1.5)
            CopyBtn.Text = "COPY LINK"
            CopyBtn.BackgroundColor3 = THEME.Accent
            StatusLabel.Text = ""
        end
    end)

    ExecuteBtn.MouseButton1Click:Connect(function()
        playSound(CLICK_SOUND)
        local enteredKey = KeyInput.Text:gsub("%s+", ""):upper()
        
        if enteredKey == "" then
            KeyInput.PlaceholderText = "Please enter key!"
            KeyInput.PlaceholderColor3 = THEME.Error
            StatusLabel.Text = "Enter a key first"
            StatusLabel.TextColor3 = THEME.Error
            
            TweenService:Create(KeyInput, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out, 3, true), {
                Position = UDim2.new(0.075, 32, 0.371, 0)
            }):Play()
            
            task.wait(1)
            KeyInput.PlaceholderText = "Paste your key here..."
            KeyInput.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
            StatusLabel.Text = ""
            return
        end
        
        ExecuteBtn.Text = "üîç CHECKING..."
        ExecuteBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
        ExecuteBtnStroke.Color = Color3.fromRGB(50, 150, 255)
        StatusLabel.Text = "Validating key..."
        StatusLabel.TextColor3 = Color3.fromRGB(50, 150, 255)
        
        local currentKeys = KeyValidator.fetchCurrentKeys()
        
        if currentKeys then
            if currentKeys[enteredKey] then
                ExecuteBtn.Text = "‚úÖ SUCCESS!"
                ExecuteBtn.BackgroundColor3 = THEME.Success
                ExecuteBtnStroke.Color = THEME.Success
                StatusLabel.Text = "Key verified!"
                StatusLabel.TextColor3 = THEME.Success
                
                TweenService:Create(Main, TweenInfo.new(0.5), {
                    BackgroundColor3 = Color3.fromRGB(0, 30, 0),
                    Size = UDim2.new(0, 420, 0, 360)
                }):Play()
                
                task.wait(0.3)
                
                TweenService:Create(Main, TweenInfo.new(0.3), {
                    Size = UDim2.new(0, 400, 0, 350)
                }):Play()
                
                task.wait(1)
                keyWindow:Destroy()
                verified = true
                
            else
                ExecuteBtn.Text = "‚ùå INVALID KEY"
                ExecuteBtn.BackgroundColor3 = THEME.Error
                ExecuteBtnStroke.Color = THEME.Error
                StatusLabel.Text = "Key not found"
                StatusLabel.TextColor3 = THEME.Error
                
                TweenService:Create(KeyInput, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out, 3, true), {
                    Position = UDim2.new(0.075, 32, 0.371, 0)
                }):Play()
                
                KeyInput.Text = ""
                KeyInput.PlaceholderText = "Wrong key! Try again"
                KeyInput.PlaceholderColor3 = THEME.Error
                
                task.wait(2)
                ExecuteBtn.Text = "EXECUTE"
                ExecuteBtn.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
                ExecuteBtnStroke.Color = Color3.fromRGB(0, 150, 255)
                KeyInput.PlaceholderText = "Paste your key here..."
                KeyInput.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
                StatusLabel.Text = ""
            end
        else
            ExecuteBtn.Text = "üåê CONNECTION ERROR"
            ExecuteBtn.BackgroundColor3 = THEME.Warning
            ExecuteBtnStroke.Color = THEME.Warning
            StatusLabel.Text = "Check connection"
            StatusLabel.TextColor3 = THEME.Warning
            
            task.wait(2)
            ExecuteBtn.Text = "EXECUTE"
            ExecuteBtn.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
            ExecuteBtnStroke.Color = Color3.fromRGB(0, 150, 255)
            StatusLabel.Text = ""
        end
    end)

    KeyInput.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            ExecuteBtn.MouseButton1Click()
        end
    end)

    GamePassBtn.MouseButton1Click:Connect(function()
        playSound(CLICK_SOUND)
        MarketplaceService:PromptGamePassPurchase(player, 1608444260)
        StatusLabel.Text = "Opening purchase..."
        StatusLabel.TextColor3 = Color3.fromRGB(0, 150, 255)
        
        task.wait(2)
        StatusLabel.Text = "Checking..."
        
        task.wait(3)
        if checkGamePassOwnership() then
            StatusLabel.Text = "Purchased! Loading..."
            StatusLabel.TextColor3 = THEME.Success
            
            ExecuteBtn.Text = "‚úÖ SUCCESS!"
            ExecuteBtn.BackgroundColor3 = THEME.Success
            ExecuteBtnStroke.Color = THEME.Success
            
            TweenService:Create(Main, TweenInfo.new(0.5), {
                BackgroundColor3 = Color3.fromRGB(0, 30, 0)
            }):Play()
            
            task.wait(1)
            keyWindow:Destroy()
            verified = true
        else
            StatusLabel.Text = "Purchase failed"
            StatusLabel.TextColor3 = THEME.Warning
        end
    end)

    local dragging = false
    local dragStart, startPos

    Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = Main.Position
            MainStroke.Color = Color3.fromRGB(255, 100, 100)
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            Main.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)

    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
            MainStroke.Color = THEME.Accent
        end
    end)

    CopyBtn.MouseEnter:Connect(function()
        if CopyBtn.Text == "COPY LINK" then
            CopyBtn.BackgroundColor3 = Color3.fromRGB(240, 60, 60)
        end
    end)

    CopyBtn.MouseLeave:Connect(function()
        if CopyBtn.Text == "COPY LINK" then
            CopyBtn.BackgroundColor3 = THEME.Accent
        end
    end)

    ExecuteBtn.MouseEnter:Connect(function()
        if ExecuteBtn.Text == "EXECUTE" then
            ExecuteBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 230)
            ExecuteBtnStroke.Color = Color3.fromRGB(0, 170, 255)
        end
    end)

    ExecuteBtn.MouseLeave:Connect(function()
        if ExecuteBtn.Text == "EXECUTE" then
            ExecuteBtn.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
            ExecuteBtnStroke.Color = Color3.fromRGB(0, 150, 255)
        end
    end)

    GamePassBtn.MouseEnter:Connect(function()
        GamePassBtn.BackgroundColor3 = Color3.fromRGB(0, 100, 180)
        GamePassBtnStroke.Color = Color3.fromRGB(0, 150, 220)
    end)

    GamePassBtn.MouseLeave:Connect(function()
        GamePassBtn.BackgroundColor3 = Color3.fromRGB(0, 80, 150)
        GamePassBtnStroke.Color = Color3.fromRGB(0, 120, 200)
    end)

    Main.Size = UDim2.new(0, 0, 0, 0)
    TweenService:Create(Main, TweenInfo.new(0.6, Enum.EasingStyle.Back), {
        Size = UDim2.new(0, 400, 0, 350)
    }):Play()

    while keyWindow and keyWindow.Parent do
        if verified then
            return true
        end
        task.wait(0.1)
    end
    
    return verified
end

local function loadMainScript()
    local mainScriptUrl = "https://raw.githubusercontent.com/LORLN9/LORLN-PRO/refs/heads/main/Lorlnnnn"
    
    local success, errorMsg = pcall(function()
        local scriptCode = game:HttpGet(mainScriptUrl, true)
        loadstring(scriptCode)()
    end)
    
    if not success then
        local notifyGui = Instance.new("ScreenGui", playerGui)
        notifyGui.Name = "ErrorNotification"
        notifyGui.DisplayOrder = 99999
        
        local frame = Instance.new("Frame", notifyGui)
        frame.Size = UDim2.new(0, 350, 0, 100)
        frame.Position = UDim2.new(0.5, -175, 0.5, -50)
        frame.BackgroundColor3 = Color3.fromRGB(30, 0, 0)
        frame.BorderSizePixel = 0
        
        Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 10)
        
        local stroke = Instance.new("UIStroke", frame)
        stroke.Color = Color3.fromRGB(255, 50, 50)
        stroke.Thickness = 2
        
        local title = Instance.new("TextLabel", frame)
        title.Size = UDim2.new(1, -20, 0, 30)
        title.Position = UDim2.new(0, 10, 0, 10)
        title.Text = "‚ö†Ô∏è ERROR"
        title.Font = Enum.Font.GothamBold
        title.TextSize = 16
        title.TextColor3 = Color3.fromRGB(255, 100, 100)
        title.BackgroundTransparency = 1
        
        local message = Instance.new("TextLabel", frame)
        message.Size = UDim2.new(1, -20, 0, 50)
        message.Position = UDim2.new(0, 10, 0, 45)
        message.Text = "Failed to load main script."
        message.Font = Enum.Font.Gotham
        message.TextSize = 13
        message.TextColor3 = Color3.fromRGB(200, 200, 200)
        message.TextWrapped = true
        message.BackgroundTransparency = 1
        
        task.wait(5)
        notifyGui:Destroy()
    end
end

if checkGamePassOwnership() then
    loadMainScript()
    return
end

local hasValidKey = false
local currentKeys = KeyValidator.fetchCurrentKeys()

if currentKeys then
    local keySystem = createKeySystem()
    if not keySystem then
        local denyGui = Instance.new("ScreenGui", playerGui)
        denyGui.Name = "AccessDenied"
        denyGui.DisplayOrder = 99999
        
        local frame = Instance.new("Frame", denyGui)
        frame.Size = UDim2.new(0, 300, 0, 150)
        frame.Position = UDim2.new(0.5, -150, 0.5, -75)
        frame.BackgroundColor3 = Color3.fromRGB(30, 0, 0)
        frame.BorderSizePixel = 0
        
        Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 10)
        
        local stroke = Instance.new("UIStroke", frame)
        stroke.Color = THEME.Accent
        stroke.Thickness = 2
        
        local icon = Instance.new("ImageLabel", frame)
        icon.Size = UDim2.new(0, 50, 0, 50)
        icon.Position = UDim2.new(0.5, -25, 0, 15)
        icon.Image = "rbxassetid://131690304470847"
        icon.BackgroundTransparency = 1
        
        local title = Instance.new("TextLabel", frame)
        title.Size = UDim2.new(1, -20, 0, 30)
        title.Position = UDim2.new(0, 10, 0, 75)
        title.Text = "üîí ACCESS DENIED"
        title.Font = Enum.Font.GothamBold
        title.TextSize = 18
        title.TextColor3 = THEME.Accent
        title.BackgroundTransparency = 1
        
        local message = Instance.new("TextLabel", frame)
        message.Size = UDim2.new(1, -20, 0, 40)
        message.Position = UDim2.new(0, 10, 0, 105)
        message.Text = "Valid key or GamePass required"
        message.Font = Enum.Font.Gotham
        message.TextSize = 13
        message.TextColor3 = Color3.fromRGB(200, 200, 200)
        message.BackgroundTransparency = 1
        
        task.wait(5)
        denyGui:Destroy()
        return
    else
        loadMainScript()
    end
else
    loadMainScript()
end
